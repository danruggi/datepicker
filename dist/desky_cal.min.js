function adjustCalendarPosition(e){let{bottom:t,right:a}=e.getBoundingClientRect();window.innerHeight;let n=window.innerWidth;a>n&&(e.style.right="2px")}function generateDowList(){let e=new Date(2021,8),t="";for(let a=1;a<=21;a++){e.setDate(a);let n=e.toLocaleString("default",{weekday:"long"}).charAt(0);if((0!==t.length||0===e.getDay())&&(t+=`<span>${n}</span>`),6===e.getDay()&&0!==t.length)break}return t}function buildCalendarHTML(e,t){let a=t.mode||"single",n=t.anyDate?buildAnyDateHTML(e):"";return`
        <div class='desky-dark-container desky-cal-hidden'>
            <div class='desky-calendar-container ${"single"===a?"single":""}' id='deskycal_${e}'>
                <span class='desky-cal-close' id='desky-close-${e}'>X</span>
                ${"double"===a?buildLeftSectionHTML(e):""}
                <div class='right'>
                    ${buildRightSectionHTML(e)}
                    ${n}
                </div>
            </div>
        </div>
        `}function buildLeftSectionHTML(e){return`
        <div class='left'>
            <span class='left-today'>Today</span>
            <span class='left-day'></span>
            <span class='left-mon'></span>
        </div>
    `}function buildRightSectionHTML(e){return`
        <div class='desky-cal-right-header arrows'>
            <span class='desky-arrow sel-prev-month'>&lt;</span>
            <span class='desky-cal-month-name'></span>
            <span class='desky-cal-month-num desky-cal-hidden'></span>
            <span class='desky-arrow sel-next-month'>&gt;</span>
        </div>
        <div class='desky-cal-right-bottom'>
            <div class='desky-cal-dow-list'></div>
            <div class='desky-cal-day-list'></div>
        </div>
    `}function buildAnyDateHTML(e){return`<span data-day='calsel_anyDate_${e}' class='curr-month cal-sel-day any-date-day'>
                Any Date
            </span>`}function parseHTML(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content}class DeskyCalendar{constructor(e){this.options=e||{},this.calendars={},this.init()}init(){let e=Object.keys(this.options);if(0===e.length){console.error("Initialize deskyOpts before using this function");return}e.forEach(e=>this.setupCalendar(e)),console.log(this.options)}createContainer(e){let t=document.getElementById(e);if(!t){console.error(`Input id ${e} not found`);return}let a=t.parentNode,n=t.cloneNode(!0);n.readOnly=!0,n.dataset.origId=e,n.addEventListener("click",t=>this.calSelShowUp(t,e));let l=document.createElement("div");l.id=`desky-added-parent-${e}`,l.classList.add("desky-cal-parent","deskycal"),l.dataset.origId=e,l.appendChild(n),a.replaceChild(l,t),this.calendars[e]={newInput:n,newParent:l,calendarWrapper:null}}initializeDate(e){let t=this.options[e],a=t.defaultDate||new Date;this.calendars[e].newInput.value=this.formatDateToLocal(a),this.calendars[e].centerDate=a;let n=this.options[e].nextInput;n&&(this.options[n].disableBefore=a,this.options[n].defaultDate=a)}formatDate(e){return e.toISOString().split("T")[0]}formatDateToLocal(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`}insertCalSchema(e){console.log(this.calendars[e]),console.log(this.options[e]);let t=buildCalendarHTML(e,this.options[e]),a=parseHTML(t);this.calendars[e].newParent.appendChild(a),this.calendars[e].calendarWrapper=this.calendars[e].newParent.querySelector(".desky-dark-container"),this.calendars[e].calendarWrapper.dataset.origId=e,this.calendars[e].calendarContainer=this.calendars[e].calendarWrapper.querySelector(".desky-calendar-container"),this.calendars[e].calendarContainer.dataset.origId=e;let n=generateDowList(),l=this.calendars[e].newParent.querySelector(".desky-cal-dow-list");l&&(l.innerHTML=n),this.calendars[e].closeButton=this.calendars[e].newParent.querySelector(".desky-cal-close"),this.calendars[e].closeButton.dataset.origId=e,this.calendars[e].closeButton.addEventListener("click",t=>this.closeCalSel(t,e));let s=this.calendars[e].newParent.querySelector(".sel-next-month");s&&s.addEventListener("click",t=>this.calSelNextMonth(e));let i=this.calendars[e].newParent.querySelector(".sel-prev-month");i&&i.addEventListener("click",t=>this.calSelPrevMonth(e));let r=this.calendars[e].calendarContainer.querySelector(".left");r&&r.addEventListener("click",t=>this.dayClick(r,e));let d=this.calendars[e].calendarContainer.querySelector(".any-date-day");d&&d.addEventListener("click",t=>this.dayClick(d,e))}calSelDrawDays(e,t,a){let n=new Date,l="",s="",i=this.calendars[e].calendarContainer.querySelector(".desky-cal-month-name"),r=this.calendars[e].calendarContainer.querySelector(".desky-cal-month-num"),d=this.calendars[e].calendarContainer.querySelector(".desky-cal-day-list");isNaN(t)&&(t=n.getFullYear()),isNaN(a)&&(a=n.getMonth());let c=new Date(t,a,1),o=new Date(t,a+1,0),h=c.getDay(),p=o.getDay(),u=c.toLocaleString("default",{month:"long"}),y=new Date,g=y.toLocaleString("default",{month:"long"}),D=`calsel_${t}_${y.getMonth()+1}_${y.getDate()}`;"double"===this.options[e].mode&&(this.calendars[e].calendarContainer.querySelector(".left-day").innerText=n.getDate(),this.calendars[e].calendarContainer.querySelector(".left-mon").innerText=g,this.calendars[e].calendarContainer.querySelector(".left").dataset.day=D),i.innerText=`${u} ${c.getFullYear()}`,r.innerText=`${a}_${t}`;let k=a+1;c.getDate();let f=o.getDate(),m=new Date(t,a,0).getDate();for(let C=m-h+1;C<=m;C++)l+=`<span class='last-month cal-sel-day'>
                        ${C}
                    </span>`;let S=new Date;S.setMonth(a);for(let L=1;L<=f;L++){s=`calsel_${t}_${k}_${(S=new Date(S.setDate(L))).getDate()}`;let w="";D===s&&(w="today"),this.options[e].disableBefore&&S.getTime()<this.options[e].disableBefore.getTime()&&(w="disabled"),this.options[e].disableAfter&&S.getTime()>this.options[e].disableAfter.getTime()&&(w="disabled"),l+=`<span data-day='${s}' class='curr-month cal-sel-day ${w}'>
                        ${S.getDate()}
                    </span>`}for(let v=1;v<7-p;v++)(S=new Date).setDate(v),S.setMonth(a+1),l+=`<span class='next-month cal-sel-day'>
                        ${S.getDate()}
                    </span>`;let T=parseHTML(l);for(;d.firstChild;)d.removeChild(d.lastChild);d.appendChild(T),this.addDayClickListeners(d,e)}addDayClickListeners(e,t){let a=e.querySelectorAll(".cal-sel-day");a.forEach(e=>{e.addEventListener("click",a=>this.dayClick(e,t))})}calSelPrevMonth(e){let t=this.calendars[e].calendarContainer.querySelector(".desky-cal-month-num").innerText.split("_"),a=parseInt(t[0])-1,n=parseInt(t[1]);a<0&&(a=11,n--),this.calSelDrawDays(e,n,a)}calSelNextMonth(e){let t=this.calendars[e].calendarContainer.querySelector(".desky-cal-month-num").innerText.split("_"),a=parseInt(t[0])+1,n=parseInt(t[1]);a>11&&(a=0,n++),this.calSelDrawDays(e,n,a)}calSelShowUp(e,t){e.stopPropagation(),this.calendars[t].calendarWrapper.classList.toggle("desky-cal-hidden"),this.options[t].scroll&&this.calendars[t].calendarContainer.scrollIntoView({behavior:"smooth",block:"center"}),adjustCalendarPosition(this.calendars[t].calendarContainer);let a=new Date().getFullYear(),n=new Date().getMonth();this.calendars[t].centerDate&&(a=this.calendars[t].centerDate.getFullYear(),n=this.calendars[t].centerDate.getMonth()),this.calSelDrawDays(t,a,n);let l=e=>this.closeCalSel(e,t);this.calendars[t].handleCloseCalSel=l,document.addEventListener("mouseup",l)}dayClick(e,t){if(e.classList.contains("disabled"))return;e.classList.add("clicked");let a=e.dataset.day.split("_"),n=new Date;"anyDate"==a[1]?(this.calendars[t].newInput.value="Any Date",this.calendars[t].centerDate=null):(n.setFullYear(a[1]),n.setMonth(a[2]-1),n.setDate(a[3]),console.log(`Center Date: ${n}`),this.calendars[t].newInput.value=this.formatDateToLocal(n),this.calendars[t].centerDate=n),"function"==typeof this.options[t].callback&&(console.log("Call Back Function"),this.options[t].callback(this.calendars[t].centerDate)),null!=this.options[t].nextInput&&this.initializeNextInput(t),setTimeout(()=>{e.classList.remove("clicked"),this.closeCalSel(null,t)},300)}initializeNextInput(e){let t=this.options[e].nextInput,a=this.calendars[e].centerDate;a?(this.options[t].disableBefore=a,this.calendars[t].centerDate=a,this.calendars[t].newInput.value=this.formatDateToLocal(a)):(this.options[t].disableBefore=null,this.calendars[t].centerDate=null,this.calendars[t].newInput.value=this.formatDateToLocal(new Date))}closeCalSel(e,t){if(!t){console.log("Missing id");return}let a=this.calendars[t].closeButton;if(e&&a&&a.contains(e.target)||e&&!this.calendars[t].calendarWrapper.contains(e.target)){this.calendars[t].calendarWrapper.classList.add("desky-cal-hidden"),document.removeEventListener("mouseup",this.calendars[t].handleCloseCalSel);return}e||(this.calendars[t].calendarWrapper.classList.add("desky-cal-hidden"),document.removeEventListener("mouseup",this.calendars[t].handleCloseCalSel))}setupCalendar(e){this.createContainer(e),this.initializeDate(e),this.insertCalSchema(e)}}
