const deskyOpts={};function initDeskyCalendar(d,c="double",i=null,o=!1,r=null,y=null,u=null,p=!1,k=null){let g=document.getElementById(d);if(null==g)console.log("[deskyCal] input id "+d+" not found");else{["double","single"].includes(c=null==c?"double":c)||console.log('[deskyCal] "mode" not valid; "single" or "double" are valid'),i<0&&console.log("[deskyCal] timestamp can't be negative"),deskyOpts[d]={mode:c,in_date:i,any_date:o,next_input:r,disabled_before:y,disabled_after:u,callback:k,scroll:p};let e=parseHTML("<div id='deskycal_container_"+d+"' class='deskycal'></div>").firstChild,t=g.cloneNode(!0),a=g.parentNode;e.appendChild(t),a.replaceChild(e,g),t.readOnly=!0,t.addEventListener("click",function(e){showCalSel(e,this)});let l,n;if(o)t.value="Select";else{let e=new Date;1e3<i&&(e.setTime(i),l=e.getMonth(),n=e.getFullYear(),deskyOpts[d].in_date=e.getTime()),t.value=e.getFullYear()+"-"+String(parseInt(e.getMonth())+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")}let s=new Date;1e3<y&&(s.setTime(y),deskyOpts[d].disabled_before=s.getTime()+864e5),insertSchema(e,d),drawCalSel(e,d,n,l)}}function insertSchema(e,t){let a="",l="";"single"==deskyOpts[t].mode&&(l="single"),a=(a+="<div class='desky-dark-container desky-cal-hidden'>")+"\t<div class='desky-cal-container  "+l+"' id='deskycal_"+t+"'>\t\t<span class='desky-cal-close' onclick='closeCalSel()'>X</span>","double"==deskyOpts[t].mode&&(a=(a+="\t\t<div class='flex-container flex-col centered left' onClick='dayClick(this)'>")+"\t\t\t<span class='left-today'>Today</span> <span class='left-day'></span> <span class='left-mon'></span>\t\t</div>"),a=(a=(a=(a=(a=(a+="\t\t<div class='right'>")+"\t\t\t<div class='desky-cal-right-header arrows'>\t\t\t\t<span class='desky-arrow' onclick='calSelPrev(this)'><</span>")+"\t\t\t\t<span class='desky-cal-month-name'></span>\t\t\t\t<span class='desky-cal-month-num desky-cal-hidden' ></span>")+"\t\t\t\t<span class='desky-arrow' onclick='calSelNext(this)'>></span>\t\t\t</div>")+"\t\t\t<div class='desky-cal-right-bottom'>\t\t\t\t<div class='desky-cal-dow-list'></div>")+"\t\t\t\t<div class='desky-cal-day-list'> </div>\t\t\t</div>",deskyOpts[t].any_date&&(a+="\t\t\t<span data-day='calsel_anyDate_"+t+"' class='curr-month cal-sel-day' onClick='dayClick(this)'>Any Date</span>");t=parseHTML(a=(a+="\t\t</div>")+"\t</div>"+"</div>");e.appendChild(t);let n=new Date,s=(n.setYear(2021),n.setMonth(8),"");for(let e=1;e<=21&&(n.setDate(e),0!=s.length&&(s+="<span>"+n.toLocaleString("default",{weekday:"long"}).charAt(0)+"</span>"),0==n.getDay()&&(s+="<span>"+n.toLocaleString("default",{weekday:"long"}).charAt(0)+"</span>"),6!=n.getDay()||0==s.length);e++);e.querySelector(".desky-cal-dow-list").innerHTML=s}function drawCalSel(e,a,l,t){console.log(t+" "+l);let n=new Date,s=new Date,d="";var c;let i=e.querySelector(".desky-cal-month-name"),o=e.querySelector(".desky-cal-month-num"),r=e.querySelector(".desky-cal-day-list"),y=(isNaN(l)&&(l=n.getFullYear()),isNaN(t)&&(t=n.getMonth()),new Date(l,t,1)),u=new Date(l,t+1,0);var p=y.getDay(),k=u.getDay(),g=y.toLocaleString("default",{month:"long"});let m=new Date;var h=m.toLocaleString("default",{month:"long"}),f="calsel_"+l+"_"+(parseInt(m.getMonth())+1)+"_"+m.getDate(),S=("double"==deskyOpts[a].mode&&(e.querySelector(".left-day").innerText=n.getDate(),e.querySelector(".left-mon").innerText=h,e.querySelector(".left").dataset.day=f),i.innerText=g+" "+y.getFullYear(),o.innerText=t+"_"+l,t+1),v=(y.getDate(),u.getDate()),C=new Date(l,t,0).getDate();s=new Date;for(let e=C-p+1;e<=C;e++)d+="<span class='last-month cal-sel-day'>"+e+"</span>";(s=new Date).setMonth(t);for(let t=1;t<=v;t++){let e=f==(c="calsel_"+l+"_"+S+"_"+(s=new Date(s.setDate(t))).getDate())?"today":"";s.getTime()<deskyOpts[a].disabled_before&&(e="disabled"),s.getTime()>deskyOpts[a].disabled_after&&null!=deskyOpts[a].disabled_after&&(e="disabled"),d+="<span data-day='"+c+"' class='curr-month cal-sel-day "+e+"' onClick='dayClick(this)'>"+s.getDate()+"</span>"}for(let e=1;e<7-k;e++)(s=new Date).setDate(e),s.setMonth(t+1),d+="<span class='next-month cal-sel-day'>"+s.getDate()+"</span>";for(h=parseHTML(d);r.firstChild;)r.removeChild(r.lastChild);r.appendChild(h)}function calSelPrev(e){let t=getParentByClass(e,"desky-cal-container");var e=t.querySelector(".desky-cal-month-num").innerText.split("_"),a=parseInt(e[0])-1;drawCalSel(t,t.id.split("_").slice(1).join("_"),e[1],a)}function calSelNext(e){let t=getParentByClass(e,"desky-cal-container");var e=t.querySelector(".desky-cal-month-num").innerText.split("_"),a=parseInt(e[0])+1;drawCalSel(t,t.id.split("_").slice(1).join("_"),e[1],a)}function dayClick(l){if(!l.classList.contains("disabled")){l.classList.add("clicked");var n=l.dataset.day.split("_");let e=getParentByClass(l,"desky-cal-container").id;var s=e.substring(e.indexOf("_")+1);let t=document.getElementById(s),a=new Date;if("anyDate"==n[1]?t.value="Any":(a.setYear(n[1]),a.setMonth(n[2]-1),a.setDate(n[3]),t.value=a.getFullYear()+"-"+String(parseInt(a.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(a.getDate())).padStart(2,"0")),"function"==typeof deskyOpts[s].callback&&(console.log("call back function"),deskyOpts[s].callback(a)),null!=deskyOpts[s].next_input){var s=deskyOpts[s].next_input,d=document.getElementById("deskycal_container_"+s);let e=document.getElementById(s);deskyOpts[s].disabled_before=a.getTime(),e.value=a.getFullYear()+"-"+String(parseInt(a.getMonth())+1).padStart(2,"0")+"-"+String(parseInt(a.getDate())).padStart(2,"0"),drawCalSel(d,s,n[1],n[2]-1)}setTimeout(function(){l.classList.remove("clicked"),closeCalSel()},300)}}function showCalSel(e,t){e.stopPropagation();let a=t.parentNode,l=a.querySelector(".desky-dark-container");l.classList.toggle("desky-cal-hidden"),deskyOpts[t.id].scroll&&l.scrollIntoView({behavior:"smooth",block:"center"}),document.addEventListener("mouseup",deskyCalSelEvent)}function closeCalSel(){document.querySelectorAll(".desky-dark-container").forEach(function(e){e.classList.contains("desky-cal-hidden")||e.classList.add("desky-cal-hidden")}),document.removeEventListener("mouseup",deskyCalSelEvent)}function deskyCalSelEvent(a){document.querySelectorAll(".deskycal").forEach(function(e){let t=e.querySelector(".desky-dark-container");null==t||t.classList.contains("desky-cal-hidden")||t.contains(a.target)||closeCalSel()})}function getParentByClass(e,t,a=10){let l=0;for(;!e.classList.contains(t);)if(e=e.parentElement,++l>a)return!1;return e}function parseHTML(e){var t=document.createElement("template");return t.innerHTML=e,t.content}
